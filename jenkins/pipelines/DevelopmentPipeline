#!/bin/groovy

pipeline {
    agent {
        docker {
            image 'cusxy/jenkins-android:latest'
            label 'android'
        }
    }
    environment {
        DEBUG_KEYSTORE = credentials('debug.keystore')
        DEBUG_KEYSTORE_PROPERTIES = credentials('debug.keystore.properties')
    }
    stages {
        stage('preparation') {
            steps {
                writeFile file: './app/debug.keystore', text: readFile(DEBUG_KEYSTORE)
                writeFile file: './app/debug.keystore.properties', text: readFile(DEBUG_KEYSTORE_PROPERTIES)
            }
        }
        stage('build') {
            steps {
                sh './gradlew :app:assembleDebug'
            }
        }
        stage('test') {
            steps {
                sh './gradlew :app:testDebugUnitTest'
            }
        }
        stage('deploy') {
            steps {
                archiveArtifacts artifacts: './app/build/outputs/'
            }
        }
    }
}
